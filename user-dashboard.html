<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏—Ç–µ —Å—Ç–∞—Ç–∏–∏ - –ú–ª–∞–¥ –ñ—É—Ä–Ω–∞–ª–∏—Å—Ç</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <style>
        body { padding-top: 100px; background: #f5f7fa; }
        .dashboard-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .dashboard-header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #3498db;
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            color: #3498db;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .articles-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .article-card {
            background: white;
            border: 1px solid #eaeaea;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
        }
        
        .article-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .article-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-submitted { background: #ffeaa7; color: #d35400; }
        .status-under_review { background: #a29bfe; color: white; }
        .status-approved { background: #55efc4; color: #00b894; }
        .status-published { background: #74b9ff; color: #0984e3; }
        .status-declined { background: #ff7675; color: #d63031; }
        .status-needs_revision { background: #fd79a8; color: #e84393; }
        
        .article-meta {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            color: #666;
            font-size: 14px;
        }
        
        .article-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-view, .btn-edit, .btn-resubmit {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-view { background: #3498db; color: white; }
        .btn-edit { background: #2ecc71; color: white; }
        .btn-resubmit { background: #f39c12; color: white; }
        
        .btn-view:hover, .btn-edit:hover, .btn-resubmit:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #95a5a6;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .quick-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .action-primary {
            background: #3498db;
            color: white;
        }
        
        .action-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .status-info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .status-info h3 {
            color: #1565c0;
            margin-top: 0;
        }
        
        .status-steps {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            position: relative;
        }
        
        .status-step {
            text-align: center;
            position: relative;
            z-index: 1;
            flex: 1;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e3f2fd;
            border: 2px solid #bbdefb;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
            color: #1565c0;
        }
        
        .step-active .step-number {
            background: #1565c0;
            color: white;
            border-color: #1565c0;
        }
        
        .step-label {
            font-size: 12px;
            color: #666;
        }
        
        .status-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            height: 2px;
            background: #bbdefb;
            z-index: 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>–ú–ª–∞–¥ –ñ—É—Ä–Ω–∞–ª–∏—Å—Ç</h1>
                <p>–ú–æ–∏—Ç–µ —Å—Ç–∞—Ç–∏–∏</p>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">‚Üê –ù–∞—á–∞–ª–æ</a></li>
                    <li><a href="submit-article.html">‚úèÔ∏è –ù–∞–ø–∏—à–∏ —Å—Ç–∞—Ç–∏—è</a></li>
                    <li><a href="#" id="logoutBtn">üö™ –ò–∑—Ö–æ–¥</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="dashboard-container">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <h1>üìù –ú–æ–∏—Ç–µ —Å—Ç–∞—Ç–∏–∏</h1>
            <p>–¢—É–∫ –º–æ–∂–µ—Ç–µ –¥–∞ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞—Ç–µ –≤—Å–∏—á–∫–∏ –≤–∞—à–∏ –ø–æ–¥–∞–¥–µ–Ω–∏ —Å—Ç–∞—Ç–∏–∏ –∏ —Ç–µ—Ö–Ω–∏—è —Å—Ç–∞—Ç—É—Å</p>
            
            <div class="quick-actions">
                <a href="submit-article.html" class="action-btn action-primary">
                    ‚úèÔ∏è –ù–∞–ø–∏—à–∏ –Ω–æ–≤–∞ —Å—Ç–∞—Ç–∏—è
                </a>
                <button class="action-btn action-secondary" onclick="loadArticles()">
                    üîÑ –û–±–Ω–æ–≤–∏ —Å–ø–∏—Å—ä–∫–∞
                </button>
            </div>
            
            <!-- User Stats -->
            <div class="stats-grid" id="userStats">
                <!-- Stats will be loaded here -->
            </div>
        </div>

        <!-- Status Information -->
        <div class="status-info">
            <h3>üìã –ö–∞–∫ —Ä–∞–±–æ—Ç–∏ –ø—Ä–æ—Ü–µ—Å—ä—Ç –Ω–∞ –ø—Ä–µ–≥–ª–µ–¥:</h3>
            <div class="status-steps">
                <div class="status-step step-active">
                    <div class="step-number">1</div>
                    <div class="step-label">–ò–∑–ø—Ä–∞—Ç–µ–Ω–∞</div>
                </div>
                <div class="status-step">
                    <div class="step-number">2</div>
                    <div class="step-label">–í –ø—Ä–µ–≥–ª–µ–¥</div>
                </div>
                <div class="status-step">
                    <div class="step-number">3</div>
                    <div class="step-label">–û–¥–æ–±—Ä–µ–Ω–∞</div>
                </div>
                <div class="status-step">
                    <div class="step-number">4</div>
                    <div class="step-label">–ü—É–±–ª–∏–∫—É–≤–∞–Ω–∞</div>
                </div>
            </div>
            <p style="margin-top: 20px; color: #666;">
                <strong>–°—Ä–µ–¥–Ω–æ –≤—Ä–µ–º–µ –∑–∞ –ø—Ä–µ–≥–ª–µ–¥:</strong> 2-3 —Ä–∞–±–æ—Ç–Ω–∏ –¥–Ω–∏<br>
                <strong>–ù–æ—Ç–∏–Ω–∫–∞:</strong> –ú–æ–∂–µ—Ç–µ –¥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–∞—Ç–µ —Å—Ç–∞—Ç–∏—è—Ç–∞, –¥–æ–∫–∞—Ç–æ –µ –≤ —Å—Ç–∞—Ç—É—Å "–ò–∑–ø—Ä–∞—Ç–µ–Ω–∞"
            </p>
        </div>

        <!-- Submitted Articles -->
        <div class="articles-section">
            <div class="section-title">
                <h2>üì• –ò–∑–ø—Ä–∞—Ç–µ–Ω–∏ —Å—Ç–∞—Ç–∏–∏</h2>
                <span class="queue-count" id="submittedCount">0</span>
            </div>
            
            <div id="submittedArticles" class="articles-grid">
                <div class="empty-state">
                    <div class="empty-state-icon">üì≠</div>
                    <h3>–í—Å–µ –æ—â–µ –Ω—è–º–∞—Ç–µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∏ —Å—Ç–∞—Ç–∏–∏</h3>
                    <p>–ó–∞–ø–æ—á–Ω–µ—Ç–µ –¥–∞ –ø–∏—à–µ—Ç–µ, –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ —Å—Ç–∞—Ç–∏–∏—Ç–µ —Å–∏ —Ç—É–∫.</p>
                    <a href="submit-article.html" class="btn-view" style="margin-top: 20px;">‚úèÔ∏è –ù–∞–ø–∏—à–∏ –ø—ä—Ä–≤–∞—Ç–∞ —Å–∏ —Å—Ç–∞—Ç–∏—è</a>
                </div>
            </div>
        </div>

        <!-- Under Review Articles -->
        <div class="articles-section">
            <div class="section-title">
                <h2>üëÅÔ∏è –°—Ç–∞—Ç–∏–∏ –≤ –ø—Ä–µ–≥–ª–µ–¥</h2>
                <span class="queue-count" id="inReviewCount">0</span>
            </div>
            
            <div id="inReviewArticles" class="articles-grid">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <h3>–ù—è–º–∞ —Å—Ç–∞—Ç–∏–∏ –≤ –ø—Ä–æ—Ü–µ—Å –Ω–∞ –ø—Ä–µ–≥–ª–µ–¥</h3>
                    <p>–í–∞—à–∏—Ç–µ —Å—Ç–∞—Ç–∏–∏ —â–µ —Å–µ –ø–æ—è–≤—è—Ç —Ç—É–∫, –∫–æ–≥–∞—Ç–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–ø–æ—á–Ω–µ –¥–∞ –≥–∏ –ø—Ä–µ–≥–ª–µ–∂–¥–∞.</p>
                </div>
            </div>
        </div>

        <!-- Published Articles -->
        <div class="articles-section">
            <div class="section-title">
                <h2>‚úÖ –ü—É–±–ª–∏–∫—É–≤–∞–Ω–∏ —Å—Ç–∞—Ç–∏–∏</h2>
                <span class="queue-count" id="publishedCount">0</span>
            </div>
            
            <div id="publishedArticles" class="articles-grid">
                <div class="empty-state">
                    <div class="empty-state-icon">üì∞</div>
                    <h3>–í—Å–µ –æ—â–µ –Ω—è–º–∞—Ç–µ –ø—É–±–ª–∏–∫—É–≤–∞–Ω–∏ —Å—Ç–∞—Ç–∏–∏</h3>
                    <p>–ö–æ–≥–∞—Ç–æ —Å—Ç–∞—Ç–∏–∏—Ç–µ –≤–∏ –±—ä–¥–∞—Ç –æ–¥–æ–±—Ä–µ–Ω–∏ –∏ –ø—É–±–ª–∏–∫—É–≤–∞–Ω–∏, —â–µ —Å–µ –ø–æ—è–≤—è—Ç —Ç—É–∫.</p>
                </div>
            </div>
        </div>

        <!-- Declined/Needs Revision -->
        <div class="articles-section">
            <div class="section-title">
                <h2>üîÑ –°—Ç–∞—Ç–∏–∏, –Ω—É–∂–¥–∞–µ—â–∏ —Å–µ –æ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ</h2>
                <span class="queue-count" id="needsAttentionCount">0</span>
            </div>
            
            <div id="needsAttentionArticles" class="articles-grid">
                <div class="empty-state">
                    <div class="empty-state-icon">‚úÖ</div>
                    <h3>–ù—è–º–∞ —Å—Ç–∞—Ç–∏–∏, –Ω—É–∂–¥–∞–µ—â–∏ —Å–µ –æ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ</h3>
                    <p>–¢—É–∫ —â–µ —Å–µ –ø–æ–∫–∞–∑–≤–∞—Ç —Å—Ç–∞—Ç–∏–∏, –∫–æ–∏—Ç–æ —Å–∞ –≤—ä—Ä–Ω–∞—Ç–∏ –∑–∞ –ø—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –∏–ª–∏ —Å–∞ –æ—Ç—Ö–≤—ä—Ä–ª–µ–Ω–∏.</p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2023 –ö–ª—É–± "–ú–ª–∞–¥ –ñ—É—Ä–Ω–∞–ª–∏—Å—Ç". –í—Å–∏—á–∫–∏ –ø—Ä–∞–≤–∞ –∑–∞–ø–∞–∑–µ–Ω–∏.</p>
        </div>
    </footer>

    <script>
        // Global variables
        let currentUser = null;
        let userData = null;
        
        // Check authentication
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                await loadUserData();
                await loadArticles();
            } else {
                // Redirect to login
                alert('–ú–æ–ª—è, –≤–ª–µ–∑—Ç–µ –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –∑–∞ –¥–æ—Å—Ç—ä–ø –¥–æ —Ç–∞–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞.');
                window.location.href = 'index.html';
            }
        });
        
        // Load user data
        async function loadUserData() {
            try {
                const snapshot = await db.ref(`users/${currentUser.uid}`).once('value');
                userData = snapshot.val();
                updateUserStats();
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }
        
        // Update user statistics
        function updateUserStats() {
            const statsContainer = document.getElementById('userStats');
            if (!userData) return;
            
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">–û–±—â–æ —Å—Ç–∞—Ç–∏–∏</div>
                    <div class="stat-number">${userData.articlesSubmitted || 0}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ü—É–±–ª–∏–∫—É–≤–∞–Ω–∏</div>
                    <div class="stat-number">${userData.articlesPublished || 0}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –æ–¥–æ–±—Ä–µ–Ω–∏–µ</div>
                    <div class="stat-number">
                        ${userData.articlesSubmitted ? 
                            Math.round(((userData.articlesPublished || 0) / userData.articlesSubmitted) * 100) : 0}%
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª –æ—Ç</div>
                    <div class="stat-number">
                        ${userData.createdAt ? 
                            new Date(userData.createdAt).toLocaleDateString('bg-BG', { month: 'short', year: 'numeric' }) : 
                            '—Å–∫–æ—Ä–æ'}
                    </div>
                </div>
            `;
        }
        
        // Load user's articles
        async function loadArticles() {
            try {
                // Load all articles by this user
                const snapshot = await db.ref('articles')
                    .orderByChild('authorId')
                    .equalTo(currentUser.uid)
                    .once('value');
                
                if (!snapshot.exists()) {
                    // No articles yet
                    updateArticleCounts(0, 0, 0, 0);
                    return;
                }
                
                // Categorize articles
                const articles = [];
                let submittedCount = 0;
                let inReviewCount = 0;
                let publishedCount = 0;
                let needsAttentionCount = 0;
                
                snapshot.forEach(childSnapshot => {
                    const article = childSnapshot.val();
                    article.id = childSnapshot.key;
                    articles.push(article);
                    
                    // Count by status
                    switch(article.status) {
                        case 'submitted':
                            submittedCount++;
                            break;
                        case 'under_review':
                        case 'needs_revision':
                            inReviewCount++;
                            break;
                        case 'published':
                            publishedCount++;
                            break;
                        case 'declined':
                            needsAttentionCount++;
                            break;
                        default:
                            // If no status field (old articles), consider them published
                            if (!article.status) publishedCount++;
                    }
                });
                
                // Update counts
                updateArticleCounts(submittedCount, inReviewCount, publishedCount, needsAttentionCount);
                
                // Display articles by category
                displayArticlesByCategory(articles);
                
            } catch (error) {
                console.error('Error loading articles:', error);
                showError('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ —Å—Ç–∞—Ç–∏–∏—Ç–µ');
            }
        }
        
        // Update article counts
        function updateArticleCounts(submitted, inReview, published, needsAttention) {
            document.getElementById('submittedCount').textContent = submitted;
            document.getElementById('inReviewCount').textContent = inReview;
            document.getElementById('publishedCount').textContent = published;
            document.getElementById('needsAttentionCount').textContent = needsAttention;
        }
        
        // Display articles by category
        function displayArticlesByCategory(articles) {
            const submittedContainer = document.getElementById('submittedArticles');
            const inReviewContainer = document.getElementById('inReviewArticles');
            const publishedContainer = document.getElementById('publishedArticles');
            const needsAttentionContainer = document.getElementById('needsAttentionArticles');
            
            // Clear containers
            submittedContainer.innerHTML = '';
            inReviewContainer.innerHTML = '';
            publishedContainer.innerHTML = '';
            needsAttentionContainer.innerHTML = '';
            
            // Sort articles by date (newest first)
            articles.sort((a, b) => {
                const dateA = a.submittedAt || a.date || 0;
                const dateB = b.submittedAt || b.date || 0;
                return dateB - dateA;
            });
            
            // Display each article in appropriate container
            articles.forEach(article => {
                const articleCard = createArticleCard(article);
                
                // Determine where to place the article
                switch(article.status) {
                    case 'submitted':
                        submittedContainer.appendChild(articleCard);
                        break;
                    case 'under_review':
                    case 'needs_revision':
                        inReviewContainer.appendChild(articleCard);
                        break;
                    case 'published':
                        publishedContainer.appendChild(articleCard);
                        break;
                    case 'declined':
                        needsAttentionContainer.appendChild(articleCard);
                        break;
                    default:
                        // Old articles without status
                        publishedContainer.appendChild(articleCard);
                }
            });
            
            // Show empty states if no articles
            showEmptyStateIfNeeded(submittedContainer, 'submitted');
            showEmptyStateIfNeeded(inReviewContainer, 'inReview');
            showEmptyStateIfNeeded(publishedContainer, 'published');
            showEmptyStateIfNeeded(needsAttentionContainer, 'needsAttention');
        }
        
        // Create article card
        function createArticleCard(article) {
            const card = document.createElement('div');
            card.className = 'article-card';
            
            // Format date
            const date = article.submittedAt || article.date;
            const formattedDate = date ? new Date(date).toLocaleDateString('bg-BG') : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ –¥–∞—Ç–∞';
            
            // Get status info
            const statusInfo = getStatusInfo(article.status);
            
            // Get category name
            const categoryNames = {
                'news': '–ù–æ–≤–∏–Ω–∏',
                'interview': '–ò–Ω—Ç–µ—Ä–≤—é',
                'opinion': '–ú–Ω–µ–Ω–∏–µ',
                'culture': '–ö—É–ª—Ç—É—Ä–∞',
                'sport': '–°–ø–æ—Ä—Ç',
                'education': '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ',
                'technology': '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏'
            };
            const category = categoryNames[article.category] || article.category;
            
            card.innerHTML = `
                <span class="article-status ${statusInfo.class}">${statusInfo.text}</span>
                <h3>${article.title}</h3>
                <p class="article-excerpt">${article.excerpt || '–ù—è–º–∞ –∫—Ä–∞—Ç–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ'}</p>
                <div class="article-meta">
                    <span>üè∑Ô∏è ${category}</span>
                    <span>üìÖ ${formattedDate}</span>
                    ${article.redactorNotes ? '<span title="–ë–µ–ª–µ–∂–∫–∏ –æ—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞">üí¨ –ò–º–∞ –±–µ–ª–µ–∂–∫–∏</span>' : ''}
                </div>
                <div class="article-actions">
                    <a href="article.html?id=${article.id}" class="btn-view">üëÅÔ∏è –ü—Ä–µ–≥–ª–µ–¥</a>
                    ${article.status === 'submitted' ? `<button class="btn-edit" onclick="editArticle('${article.id}')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</button>` : ''}
                    ${article.status === 'declined' ? `<button class="btn-resubmit" onclick="resubmitArticle('${article.id}')">üîÑ –ü—Ä–µ–∏–∑–ø—Ä–∞—Ç–∏</button>` : ''}
                </div>
                ${article.declineReason ? `<p style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 5px; font-size: 14px;"><strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> ${article.declineReason}</p>` : ''}
                ${article.redactorNotes ? `<p style="margin-top: 10px; padding: 10px; background: #e3f2fd; border-radius: 5px; font-size: 14px;"><strong>–ë–µ–ª–µ–∂–∫–∏ –æ—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞:</strong> ${article.redactorNotes}</p>` : ''}
            `;
            
            return card;
        }
        
        // Get status information
        function getStatusInfo(status) {
            const statusMap = {
                'submitted': { text: '–ò–∑–ø—Ä–∞—Ç–µ–Ω–∞', class: 'status-submitted' },
                'under_review': { text: '–í –ø—Ä–µ–≥–ª–µ–¥', class: 'status-under_review' },
                'needs_revision': { text: '–ù—É–∂–¥–∞–µ —Å–µ –æ—Ç –ø—Ä–µ—Ä–∞–±–æ—Ç–∫–∞', class: 'status-needs_revision' },
                'approved': { text: '–û–¥–æ–±—Ä–µ–Ω–∞', class: 'status-approved' },
                'published': { text: '–ü—É–±–ª–∏–∫—É–≤–∞–Ω–∞', class: 'status-published' },
                'declined': { text: '–í—ä—Ä–Ω–∞—Ç–∞', class: 'status-declined' }
            };
            
            return statusMap[status] || { text: '–°—Ç–∞—Ç—É—Å –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω', class: 'status-submitted' };
        }
        
        // Show empty state if needed
        function showEmptyStateIfNeeded(container, type) {
            if (container.children.length === 0) {
                const emptyStates = {
                    'submitted': {
                        icon: 'üì≠',
                        title: '–í—Å–µ –æ—â–µ –Ω—è–º–∞—Ç–µ –∏–∑–ø—Ä–∞—Ç–µ–Ω–∏ —Å—Ç–∞—Ç–∏–∏',
                        message: '–ó–∞–ø–æ—á–Ω–µ—Ç–µ –¥–∞ –ø–∏—à–µ—Ç–µ, –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ —Å—Ç–∞—Ç–∏–∏—Ç–µ —Å–∏ —Ç—É–∫.',
                        action: '<a href="submit-article.html" class="btn-view" style="margin-top: 20px;">‚úèÔ∏è –ù–∞–ø–∏—à–∏ –ø—ä—Ä–≤–∞—Ç–∞ —Å–∏ —Å—Ç–∞—Ç–∏—è</a>'
                    },
                    'inReview': {
                        icon: 'üìã',
                        title: '–ù—è–º–∞ —Å—Ç–∞—Ç–∏–∏ –≤ –ø—Ä–æ—Ü–µ—Å –Ω–∞ –ø—Ä–µ–≥–ª–µ–¥',
                        message: '–í–∞—à–∏—Ç–µ —Å—Ç–∞—Ç–∏–∏ —â–µ —Å–µ –ø–æ—è–≤—è—Ç —Ç—É–∫, –∫–æ–≥–∞—Ç–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–ø–æ—á–Ω–µ –¥–∞ –≥–∏ –ø—Ä–µ–≥–ª–µ–∂–¥–∞.'
                    },
                    'published': {
                        icon: 'üì∞',
                        title: '–í—Å–µ –æ—â–µ –Ω—è–º–∞—Ç–µ –ø—É–±–ª–∏–∫—É–≤–∞–Ω–∏ —Å—Ç–∞—Ç–∏–∏',
                        message: '–ö–æ–≥–∞—Ç–æ —Å—Ç–∞—Ç–∏–∏—Ç–µ –≤–∏ –±—ä–¥–∞—Ç –æ–¥–æ–±—Ä–µ–Ω–∏ –∏ –ø—É–±–ª–∏–∫—É–≤–∞–Ω–∏, —â–µ —Å–µ –ø–æ—è–≤—è—Ç —Ç—É–∫.'
                    },
                    'needsAttention': {
                        icon: '‚úÖ',
                        title: '–ù—è–º–∞ —Å—Ç–∞—Ç–∏–∏, –Ω—É–∂–¥–∞–µ—â–∏ —Å–µ –æ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ',
                        message: '–¢—É–∫ —â–µ —Å–µ –ø–æ–∫–∞–∑–≤–∞—Ç —Å—Ç–∞—Ç–∏–∏, –∫–æ–∏—Ç–æ —Å–∞ –≤—ä—Ä–Ω–∞—Ç–∏ –∑–∞ –ø—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –∏–ª–∏ —Å–∞ –æ—Ç—Ö–≤—ä—Ä–ª–µ–Ω–∏.'
                    }
                };
                
                const emptyState = emptyStates[type];
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">${emptyState.icon}</div>
                        <h3>${emptyState.title}</h3>
                        <p>${emptyState.message}</p>
                        ${emptyState.action || ''}
                    </div>
                `;
            }
        }
        
        // Edit article (only if status is 'submitted')
        function editArticle(articleId) {
            // Store article ID for editing
            localStorage.setItem('editArticleId', articleId);
            window.location.href = 'submit-article.html?edit=' + articleId;
        }
        
        // Resubmit declined article
        async function resubmitArticle(articleId) {
            if (confirm('–ò—Å–∫–∞—Ç–µ –ª–∏ –¥–∞ –ø—Ä–µ–∏–∑–ø—Ä–∞—Ç–∏—Ç–µ —Ç–∞–∑–∏ —Å—Ç–∞—Ç–∏—è –∑–∞ –ø—Ä–µ–≥–ª–µ–¥?')) {
                try {
                    await db.ref(`articles/${articleId}`).update({
                        status: 'submitted',
                        resubmittedAt: firebase.database.ServerValue.TIMESTAMP,
                        declineReason: null // Clear decline reason
                    });
                    
                    alert('‚úÖ –°—Ç–∞—Ç–∏—è—Ç–∞ –µ –ø—Ä–µ–∏–∑–ø—Ä–∞—Ç–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞ –ø—Ä–µ–≥–ª–µ–¥!');
                    loadArticles(); // Refresh the list
                } catch (error) {
                    console.error('Error resubmitting article:', error);
                    alert('‚ùå –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –ø—Ä–µ–∏–∑–ø—Ä–∞—â–∞–Ω–µ: ' + error.message);
                }
            }
        }
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            auth.signOut()
                .then(() => {
                    window.location.href = 'index.html';
                });
        });
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            if (currentUser) {
                loadArticles();
            }
        }, 30000);
        
        // Show error message
        function showError(message) {
            alert('‚ùå ' + message);
        }
    </script>
</body>
</html>